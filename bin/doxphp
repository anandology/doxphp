#!/usr/bin/env php
<?php

require_once(__DIR__.'/../lib/DoxPHP/Parser/Tokens.php');
require_once(__DIR__.'/../lib/DoxPHP/Parser/Parser.php');
require_once(__DIR__.'/../lib/DoxPHP/Exception/Exception.php');
require_once(__DIR__.'/../lib/DoxPHP/Exception/OutOfBoundsException.php');

set_error_handler(function($errno, $errstr, $errfile, $errline, array $errcontext) {
    new ErrorException($errstr, 0, $errno, $errfile, $errline);
});

try {
    $tokens = new DoxPHP\Parser\Tokens(file_get_contents('php://stdin'));
    $parser = new DoxPHP\Parser\Parser();

    echo json_encode($parser->parse($tokens));
} catch (Exception $e) {
    echo $e->getMessage(), "\n";
    exit(1);
}
